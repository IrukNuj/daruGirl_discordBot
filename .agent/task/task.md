# タスクリスト: Discord Bot with Google Sheets & Drive

- [x] プロジェクト初期化
    - [x] 既存ファイルの確認
    - [/] `package.json` の作成 (TS/Lint対応)
    - [x] `.env` の作成
    - [x] `.env.example` の作成
    - [/] 開発環境設定 (TypeScript/Lint/Prettier)
        - [x] `tsconfig.json` 作成
        - [x] ESLint/Prettier 設定作成
- [x] 実装 & リファクタリング
    - [x] 実装計画の作成
    - [x] `index.ts` の実装 (Main logic)
    - [x] `googleClient.ts` の実装 (API Wrapper)
    - [x] 旧JSファイルの削除
    - [x] **リファクタリング (FP志向)**: `index.ts` を関数型スタイルに修正
    - [x] **リファクタリング (FP志向)**: `googleClient.ts` を関数型スタイルに修正
    - [x] **リファクタリング (No let)**: `googleClient.ts` から `let` を除去
    - [x] **リファクタリング (JSDoc)**: コメントをJSDoc形式に修正
    - [x] **リファクタリング (JSDoc-JP)**: コメントを日本語に翻訳
    - [x] **リファクタリング (Readable)**: 不要なコメントの削除と要約化
    - [x] **リファクタリング (Module)**: ハンドラを `src/handlers.ts` に分離
    - [x] **リファクタリング (Module)**: `googleClient.ts` を機能別ファイル (`src/google/*.ts`) に分割
    - [x] **リファクタリング (Naming)**: ファイル名・関数名をGoogleサービス明示に変更 (ファイル名のgoogle接頭辞は削除)
    - [x] **リファクタリング (Simplify)**: `index.ts` の `main` 関数を簡潔化 (`src/discord/` への分離)
    - [x] **リファクタリング (Module)**: `handlers.ts` を `src/discord/` に移動
    - [x] **リファクタリング (Imports)**: `import` を `baseUrl` (`src/`) に基づく絶対パスに統一
    - [x] **機能追加**: 12時の定期レポート機能 (Cron)
    - [x] **機能追加**: 定期レポート設定コマンド (`/レポート設定`)
    - [x] **機能追加**: タスク削除コマンド (`/やることさくじょ`)
    - [x] **リファクタリング**: コマンド名の変更 (`やりたいこと` -> `やること`)
    - [x] **リファクタリング**: Embed生成ロジックの共通化 (`embeds.ts`)
    - [x] **バグ修正**: モジュールインポートパスを相対パスに修正
    - [x] **リファクタリング**: `handlers.ts` を機能別ファイル (`src/discord/handlers/`) に分割
    - [x] **リファクタリング**: インポートパスを `@/` エイリアス形式に変更 (絶対パス)
    - [x] **DB移行**: Google Sheets -> SQLite
        - [x] 実装計画 (`migration_to_sqlite.md`) 作成
        - [x] `SETUP_GUIDE.md` 更新 (GCP手順追加)
        - [x] DB層実装 (`src/db/*.ts`)
        - [x] コマンド更新 (`description` 追加)
        - [x] 各ハンドラ/CronのDB対応
    - [x] **機能追加**: タスクカテゴリ (`type`/`category`)
        - [x] 実装計画作成 (`20251210_add_task_category.md`)
        - [x] DBスキーマ更新 (`src/db/client.ts`)
        - [x] 型定義更新 (`src/db/tasks.ts`)
        - [x] コマンド更新 (`src/discord/commands.ts`)
        - [x] ハンドラ更新 (`src/discord/handlers/taskHandler.ts`)
- [x] ドキュメント作成
    - [x] `SETUP_GUIDE.md` (環境構築・デプロイ詳細手順書) の作成
- [ ] コード管理 (ユーザー作業)
    - [ ] GitHub (またはGitLab等) リポジトリの作成
    - [ ] コードのPush
    - [ ] **GCP VMからのアクセス設定**: Privateリポジトリの場合、Deploy Key (SSH) の設定が必要
- [ ] Discord 設定 (ユーザー作業: 詳細手順はSETUP_GUIDE参照)
    - [ ] Application作成 & Botユーザー作成 (Developer Portal)
    - [ ] Token, Client ID の取得
    - [ ] サーバー招待URL生成 (Scopes: `bot`, `applications.commands`)
    - [ ] サーバーへのBot招待 & Guild ID の取得
    - [ ] `.env` への反映 (TOKEN, CLIENT_ID, GUILD_ID)
- [ ] Google Workspace 準備 (ユーザー作業: 詳細手順はSETUP_GUIDE参照)
    - [ ] スプレッドシートの新規作成 & ID取得
        - **[NOTE]** スプレッドシート自体はBotロジックからは切り離されましたが、画像保存用のDrive API認証にはまだService Accountが必要です。
        - **[NOTE]** Config用シート等の作成は不要になりました (SQLite管理)。
    - [ ] イラスト保存用Driveフォルダの新規作成 & ID取得
    - [ ] `.env` への反映 (SPREADSHEET_ID, DRIVE_FOLDER_ID)
- [ ] Google Cloud 設定 (ユーザー作業: 詳細手順はSETUP_GUIDE参照)
    - [ ] GCPプロジェクトの作成 & **請求先アカウント(Billing)の紐付け**
    - [ ] Service Account作成 & JSON Key取得・環境変数設定
    - [ ] API有効化 (Google Sheets API, Google Drive API)
    - [ ] **重要**: シートとフォルダへService Accountメールアドレスを共有 (編集者権限)
- [ ] 検証
    - [ ] ローカルでの起動確認 (`npm run dev`)
        - **[IMPORTANT]** `npm install` (including `better-sqlite3`) is required.
    - [ ] コマンド動作確認
- [ ] デプロイ (GCP Compute Engine)
    - [ ] VMセットアップスクリプト(startup-script)作成
    - [ ] VM作成 (e2-micro/Ubuntu, USリージョン推奨)
    - [ ] 接続 & Git Clone (Deploy Key設定済み前提)
    - [ ] **サーバー上での `.env` 作成**
    - [ ] サーバー内環境構築 (npm install, build)
    - [ ] PM2による起動 & 常時稼働設定 (startup)
    - [ ] 動作確認 (ログ確認 `pm2 logs`)
